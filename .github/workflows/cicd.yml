---

name: CI/CD

on:
  push:
    branches: [demo]
  pull_request:
    branches: [demo]
  workflow_dispatch:
    # Inputs the workflow accepts.
    inputs:
      systemUnderTest:
        description: 'System Under Test'
        required: true
        default: 'OptimusPrime'
        type: choice
        options:
          - OptimusPrime
          - JetFire
      workload:
        description: 'Workload'
        required: true
        default: 'load'
        type: choice
        options:
          - load
          - stress
      service:
        description: 'Service name'
        required: true
        default: 'optimus-prime'
        type: choice
        options:
          - optimus-prime
          - jet-fire

jobs:

  build:
    uses: perfana/afterburner/.github/workflows/build-deploy.yml@main
    secrets: inherit

  prepare-performance-test:
    uses: perfana/afterburner/.github/workflows/prepare-performance-test.yml@main
    needs: build
    secrets: inherit

  performance-test-gatling:
    uses: perfana/afterburner/.github/workflows/run-gatling-test.yml@main
    needs: prepare-performance-test
    secrets: inherit
    with:
      systemUnderTest: "OptimusPrime"
      workload: "load"
      service: "optimus-prime"
