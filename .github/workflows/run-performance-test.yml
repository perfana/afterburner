---

name: Run performance test

on:
  workflow_dispatch:
    # Inputs the workflow accepts.
    inputs:
      systemUnderTest:
        description: 'System Under Test'
        required: true
        default: 'OptimusPrime'
        type: choice
        options:
          - OptimusPrime
          - JetFire
          - BumbleBee
      workload:
        description: 'Workload'
        required: true
        default: 'load'
        type: choice
        options:
          - load
          - stress
      service:
        description: 'Service name'
        required: true
        default: 'optimus-prime'
        type: choice
        options:
          - optimus-prime
          - jet-fire
          - bumble-bee
      tool:
        description: 'Load test tool'
        required: true
        default: 'gatling'
        type: choice
        options:
          - gatling
          - k6
          - gatling-docker
      annotations:
        description: 'Test run annotation'
        type: string
        required: false


jobs:


  performance-test-gatling:
    uses: perfana/afterburner/.github/workflows/run-gatling-test.yml@main
    if: inputs.tool == 'gatling'
    secrets: inherit
    with:
      systemUnderTest: ${{ inputs.systemUnderTest }}
      workload: ${{ inputs.workload }}
      service: ${{ inputs.service }}
      annotations: ${{ inputs.annotations }}

  performance-test-gatling-docker:
    uses: perfana/afterburner/.github/workflows/run-gatling-docker-test.yml@main
    if: inputs.tool == 'gatling-docker'
    secrets: inherit
    with:
      systemUnderTest: ${{ inputs.systemUnderTest }}
      workload: ${{ inputs.workload }}
      service: ${{ inputs.service }}
      annotations: ${{ inputs.annotations }}

  performance-test-k6:
    uses: perfana/afterburner/.github/workflows/run-k6-test.yml@main
    if: inputs.tool == 'k6'
    secrets: inherit
    with:
      systemUnderTest: ${{ inputs.systemUnderTest }}
      workload: ${{ inputs.workload }}
      service: ${{ inputs.service }}
      annotations: ${{ inputs.annotations }}

